version: 2

sources:
  - name: "scooters_raw"
    description: "Raw data provided by scooters service"
    loader: "https://t.me/inzhenerka_dbt_bot"
    tables:
      - name: "trips"
        description: "Scooter trips"

      - name: "users"
        description: "Users of scooter service"


models:
  - name: trips_prep
    description: "Preprocessed scooter trips data with calculated metrics and cleaned pricing"
    config:
      materialized: view
    columns:
      - name: id
        description: "Unique identifier for the trip"
      - name: user_id
        description: "ID of the user who took the trip"
      - name: scooter_hw_id
        description: "Hardware ID of the scooter used"
      - name: started_at
        description: "Timestamp when the trip started"
      - name: finished_at
        description: "Timestamp when the trip ended"
      - name: start_lat
        description: "Latitude of trip start location"
      - name: start_lon
        description: "Longitude of trip start location"
      - name: finish_lat
        description: "Latitude of trip end location"
      - name: finish_lon
        description: "Longitude of trip end location"
      - name: distance_m
        description: "Trip distance in meters"
      - name: price_rub
        description: "Trip price in Russian rubles"
      - name: duration_s
        description: "Trip duration in seconds"
      - name: is_free
        description: "Boolean indicating if the trip was free (price = 0 but duration > 0)"
      - name: date
        description: "Date when the trip started"
  - name: trips_stat
    description: "Trip stats model"
    config:
      materialized: table
    columns:
      - name: trips
        description: "count trips"
      - name: users
        description: "count distinct users"
      - name: avg_duration_m
        description: "avg duration_min"
      - name: revenue_rub
        description: "sum over price_rub field"
      - name: free_trips_pct
        description: "casing is_free field"
      - name: sum_distance_km
        description: "sum of distance_m divided by 1000"
  - name: trips_stat_daily
    description: "daily trip statistics"
    config:
      materialized: table
      indexes: [
                {'columns': ['date']} #OR SIMPLY - columns: ["date"] AFTER INDEXES FROM THE NEW LINE
      ]
  - name: trips_age_daily
    description: "daily trips stats by user age"
  - name: trips_age_daily_stat
    description: "aggregation of daily trips stats by user age"
# Обращаться к источнику из любой модели теперь нужно будет строго через макрос:
# {{ source("<name>", "<table_name>") }}